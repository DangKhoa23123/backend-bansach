<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .book-image {
            max-width: 150px;
            max-height: 200px;
        }
        .book-card {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">Book Management System</h1>
        
        <!-- Form thêm/sửa sách -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title" id="formTitle">Add New Book</h5>
                <form id="bookForm">
                    <input type="hidden" id="bookId">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="title" class="form-label">Title</label>
                            <input type="text" class="form-control" id="title" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="author" class="form-label">Author</label>
                            <input type="text" class="form-control" id="author" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="price" class="form-label">Price</label>
                            <input type="number" class="form-control" id="price" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="genre" class="form-label">Genre</label>
                            <select class="form-select" id="genre" required>
                                <option value="">Select Genre</option>
                                <option value="Kinh dị">Kinh dị</option>
                                <option value="Trinh thám">Trinh thám</option>
                                <option value="Văn học">Văn học</option>
                                <option value="Văn học nước ngoài">Văn học nước ngoài</option>
                                <option value="Manga">Manga</option>
                                <option value="Tiểu thuyết">Tiểu thuyết</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" rows="3" required></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="quality" class="form-label">Quality (1-10)</label>
                            <input type="number" class="form-control" id="quality" min="1" max="10" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="thumbnail" class="form-label">Thumbnail</label>
                            <input type="file" class="form-control" id="thumbnail" accept="image/*" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="pageCount" class="form-label">Page Count</label>
                            <input type="number" class="form-control" id="pageCount" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">Reset</button>
                </form>
            </div>
        </div>

        <!-- Danh sách sách -->
        <div id="bookList" class="row">
            <!-- Books will be displayed here -->
        </div>
    </div>

    <script>
        let editing = false;
        
        // Load books when page loads
        document.addEventListener('DOMContentLoaded', loadBooks);

        // Handle form submission
        document.getElementById('bookForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('id', editing ? document.getElementById('bookId').value : Date.now().toString());
            formData.append('title', document.getElementById('title').value);
            formData.append('author', document.getElementById('author').value);
            formData.append('price', document.getElementById('price').value);
            formData.append('description', document.getElementById('description').value);
            formData.append('genre', document.getElementById('genre').value);
            formData.append('quality', document.getElementById('quality').value);
            formData.append('pageCount', document.getElementById('pageCount').value);

            
            const thumbnailInput = document.getElementById('thumbnail');
            if (thumbnailInput.files[0]) {
                formData.append('thumbnail', thumbnailInput.files[0]);
            }

            try {
                const url = editing ? `/api/books/${document.getElementById('bookId').value}` : '/api/books';
                const method = editing ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    body: formData
                });

                if (response.ok) {
                    resetForm();
                    loadBooks();
                } else {
                    alert('Error saving book');
                }
            } catch (err) {
                console.error('Error:', err);
                alert('Error saving book');
            }
        });

        // Load all books
        async function loadBooks() {
            try {
                const response = await fetch('/api/books');
                const books = await response.json();
                
                const bookList = document.getElementById('bookList');
                bookList.innerHTML = '';
                
                books.forEach(book => {
                    const bookCard = createBookCard(book);
                    bookList.appendChild(bookCard);
                });
            } catch (err) {
                console.error('Error:', err);
                alert('Error loading books');
            }
        }

        // Create book card
        function createBookCard(book) {
            const div = document.createElement('div');
            div.className = 'col-md-4 book-card';
            div.innerHTML = `
                <div class="card">
                    <img src="${book.thumbnail}" class="card-img-top book-image" alt="${book.title}">
                    <div class="card-body">
                        <h5 class="card-title">${book.title}</h5>
                        <p class="card-text">
                            <strong>Author:</strong> ${book.author}<br>
                            <strong>Price:</strong> $${book.price}<br>
                            <strong>Genre:</strong> ${book.genre}<br>
                            <strong>Quality:</strong> ${book.quality}/10
                            <strong>Pages:</strong> ${book.pageCount} pages
                        </p>
                        <p class="card-text">${book.description}</p>
                        <button class="btn btn-primary btn-sm" onclick="editBook('${book.id}')">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteBook('${book.id}')">Delete</button>
                    </div>
                </div>
            `;
            return div;
        }

        // Edit book
        async function editBook(id) {
            try {
                const response = await fetch(`/api/books`);
                const books = await response.json();
                const book = books.find(b => b.id === id);
                
                if (book) {
                    document.getElementById('bookId').value = book.id;
                    document.getElementById('title').value = book.title;
                    document.getElementById('author').value = book.author;
                    document.getElementById('price').value = book.price;
                    document.getElementById('description').value = book.description;
                    document.getElementById('genre').value = book.genre;
                    document.getElementById('quality').value = book.quality;
                    
                    document.getElementById('formTitle').textContent = 'Edit Book';
                    document.getElementById('thumbnail').required = false; // Not required when editing
                    editing = true;
                }
            } catch (err) {
                console.error('Error:', err);
                alert('Error loading book details');
            }
        }

        // Delete book
        async function deleteBook(id) {
            if (confirm('Are you sure you want to delete this book?')) {
                try {
                    const response = await fetch(`/api/books/${id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        loadBooks();
                    } else {
                        alert('Error deleting book');
                    }
                } catch (err) {
                    console.error('Error:', err);
                    alert('Error deleting book');
                }
            }
        }

        // Reset form
        function resetForm() {
            document.getElementById('bookForm').reset();
            document.getElementById('bookId').value = '';
            document.getElementById('formTitle').textContent = 'Add New Book';
            document.getElementById('thumbnail').required = true;
            editing = false;
        }
    </script>
</body>
</html>